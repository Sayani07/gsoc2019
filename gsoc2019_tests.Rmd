---
title: "Test solutions for R project : gravitas"
author: "Sayani Gupta"
date: "3/23/2019"
output: html_document
---


```{r setup, include=FALSE, echo=TRUE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, cache=TRUE)
# Load any R packages you need here
library(ggplot2)
library(dplyr)
library(lubridate)
library(ggplot2)
library(lvplot)
library(ggridges)
library(tsibbledata)
library(purrr)
library(tsibble)
```



_*Easy*_:

Explore the data aus_elec (Half-hourly electricity demand for five Australian states) from the package tsibbledata and create five different probability distribution plots for each month. For example, boxplot which shows median, quartile boundaries, hinges, whiskers and outliers is one of the ways to display distribution of data. 


```{r easy, echo=TRUE}

# distinct states

aus_elec %>%  distinct(State)

# time range

aus_elec %>%
          .$Time %>% range()

# Picking state New South Wales from May 2012 to Dec 2014

nsw_elec <- aus_elec %>%
            filter(State =="New South Wales") %>%
            filter(ymd_hms(Time) >= "2012-05-01 19:00:00 UTC") %>%  
            mutate(data_month = lubridate::month(Time))

# Boxplot

nsw_elec %>% 
  ggplot(aes(as.factor(data_month),Demand)) +
  geom_boxplot() + 
  scale_x_discrete(breaks=seq(1,12,1))  +
  ylab("Demand in MW") +
  xlab("Months") + 
  ggtitle("(a) Boxplot of demand for NSW")

# Ridge Plot

nsw_elec %>% 
  ggplot(aes(x = Demand,y=as.factor(data_month),group=data_month))+   geom_density_ridges2() +
  xlab("Demand in MW") +
  ylab("Months") + 
  ggtitle("(b) Ridge plot of demand for NSW")

# Violin Plot 

nsw_elec %>% 
  ggplot(aes(as.factor(data_month), Demand)) +
  geom_violin(alpha = 0.03) +
  geom_boxplot(width = 0.15) +
  ylab("Demand in MW") +
  xlab("Months")  +
  ggtitle("(c) Violin plot of demand for NSW")

# Decile Plot

nsw_decile <- nsw_elec %>% 
  group_by(data_month) %>%
  do({x <- .$Demand
  map_dfr(.x = seq(0.1,0.9,0.1),
          .f = ~ tibble(Quantile = .x,
                            Value = quantile(x, probs = .x,na.rm=TRUE)))
  })
  

p1 <- nsw_decile %>% 
  ggplot(aes(x = data_month,y = Value,col = as.factor(Quantile))) + 
  geom_line() +
  scale_x_continuous(breaks=seq(1,12,1)) + 
  ylab("Demand in MW") +
  xlab("Months") +
  ggtitle("(d) Decile plot of demand for NSW") 

p1


# Letter value plot

ggplot(nsw_elec, aes(as.factor(data_month), Demand)) + 
  geom_lv(aes(fill=..LV..),outlier.colour = "red",outlier.shape = 1, k=9) + 
  scale_fill_brewer() + 
  ylab("Demand in MW") +
  xlab("Months") +
  ggtitle("(e) Letter value plot of demand for NSW") 
```


_*Medium*_:

Write a summary which includes pros and cons of each of the different probability distribution plots that you have chosen.

**Boxplot**  

*Pros* - Standard boxplots display a compact distributional summary with median, quartiles, hinges, whiskers and extreme outliers. These are helpful to get an idea of the distribution at a glance. For example, it can be seen from Figure (a) that median demand is maximum for June and July and then falls considerably in September and October. Also, the variation (spread of the box) is very high in summer months (from November to January or February). 

*Cons* -We do not have an idea if the distribution for each month is multimodal. Moreover, for data less than 1000 observations, detailed estimates of tail behavior beyond the quartiles are not trustworthy. Also, the number of outliers is large for larger data set since number of outliers is proportional to the number of observations.


**Ridge Plot**

*Pros* - Ridge plots are density plots all aligned to the same horizontal scale and presented with a slight overlap. Hence the x-axis represents the electricity demand whereas the y-axis denotes month. A clear advantage over boxplots is that these plots allow us to see multimodality in the distribution. In Figure (b), we can see that distribution of almost all months have multiple modes.

*Cons* - Ridge plots can be obscuring when there is overlap of distribution for two or more categories of the y-axis. Also, if there are lot of categories, it is difficult to compare the height of the densities across categories.

**Violin Plot**  

*Pros* - Violin plots add the information available from local density estimates to summary statistics provided by box plots. The shape of the violin represents the density estimate of the variable. The more data points in a specific range, the larger the violin is for that range. Adding two density plots gives a symmetric plot which makes it easier to see the
magnitude of the density and compare across categories. Figure (c) also indicates multi-modality in most months and gives more information about tails of the distribution. For example, the month January has a longer right tail, and June and July which has higher median demand look uni-modal.

*Cons* - The density in violin plots are estimated through kernel density estimation and thus makes assumptions when selecting kernel or bandwidth. As a result, the plot shows smooth summaries based on the assumptions and not only on actual observations. 

**Decile Plot**

*Pros* - No distributional assumptions are made about the data since empirical deciles are plotted. It avoids much clutter and just enable us to focus on specific probabilities. Figure (d) shows clearly that all deciles for the month of July are higher than any other month. Careful scrutiny is required to establish this fact in earlier plots.

*Cons* - Decile plots do not allow us see the shape, skewness or nature of the tail of the distribution with so much clarity as violin plots, ridge plots or letter value plots.

**Letter Value plot** 

*Pros* - Letter value plots convey detailed information about tails of the distribution and outliers are unexpected observations rather than extreme observations. M, F, E, D and C represents 50%, 25%, 12.5%, 6.25% and 3.13% of the tail area respectively and so on. It shows only actual data values and no smoothed summaries. 

*Cons* - The letter values are shown till the depths where the letter values are reliable estimates of their corresponding quantiles. These might lead to a lot of letter values being shown and leading to overload of information in one plot. For example, the number of letter values computed are 10 in Figure (e) making it difficult to compare all letter values efficiently across categories.

None of the plots indicate that the number of observations used to compute median, summary statistics or densities are different for different months. The time horizon considered for the analysis is from May, 2012 to Dec, 2014. Hence the number of observations for the period May - December are higher compared to the period Jan - Apr. All these plots can be made more informative using this information.

*Hard* :

Create a R code to populate two additional numeric vectors in your data denoting hour-of-week and week-of-month. 
  
```{r hard, echo=TRUE}
hour_week = function(t_index)
{
day_week <- lubridate::wday(t_index)
hour_week_indx <- lubridate::hour(t_index) + 24*(day_week-1)
hour_week_indx
}

first_day_of_month_wday <- function(dy) {
m = month(dy)
y = year(dy)
first_day_month = paste0(y,"-",m,"-","01")
wday(first_day_month)
}

week_month = function(t_index)
{
ceiling((lubridate::day(t_index) + first_day_of_month_wday(t_index) - 1) / 7)
}

aus_elec_rev <- aus_elec %>% mutate(h_w = hour_week(Time), w_m = week_month(Time))


aus_elec_rev
```




